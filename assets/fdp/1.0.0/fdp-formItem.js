define("fdp/1.0.0/fdp-formItem",["./fdp-namespace","cellula/0.4.2/cellula","cellula/0.4.2/cellula-namespace","cellula/0.4.2/cellula-class","cellula/0.4.2/cellula-util","cellula/0.4.2/cellula-events","cellula/0.4.2/cellula-cell","cellula/0.4.2/cellula-element","cellula/0.4.2/cellula-collection","$"],function(a,b,c){var d=a("./fdp-namespace"),e=a("cellula/0.4.2/cellula"),f=a("$"),g=e._util,h=e.Class,i=(e.Element,e.Cell),j=(e.Collection,["INPUT","SELECT","RADIO","CHECKBOX","TEXTAREA"]),k=d.FormItem=new h("FormItem",{type:"input",require:!0,validate:!1,hideClass:"fn-hide",errorClass:"mi-form-item-error",errorMessage:void 0,tipClass:"mi-form-explain",label:void 0,tip:void 0,element:void 0,tipElement:void 0,name:void 0,value:void 0,beforeValidate:void 0,afterValidate:void 0,init:function(a){if(this._super(a),this.key=this.key?this.key:this.__cid__,this.type=this.type.toUpperCase(),this.allowItemType())throw new Error("formItem type is error!");this.setElement(),this._bindAll("focus","blur"),this.bindDefaultEvent()},revalidate:function(a){this.triggerValidate(a)},allowItemType:function(){return-1==f.inArray(this.type,j)},setElement:function(){var a,b=[],c=this.rootNode&&g.getElementsByClassName(this.tipClass,this.rootNode)[0];if("INPUT"==this.type||"TEXTAREA"==this.type||"SELECT"==this.type)if(this.element=this.rootNode&&this.rootNode.getElementsByTagName(this.type),1==this.element.length)this.element=this.element[0],this.name=this.element&&this.element.name;else{for(a=0,len=this.element.length;a<len;a++)b.push({ele:this.element[a],name:this.element[a].name,value:this.element[a].value});this.element=b}("RADIO"==this.type||"CHECKBOX"==this.type)&&(this.element=f("[type="+this.type+"]",this.rootNode),this.name=this.element&&this.element[0].name),c&&(this.tipElement=c,this.tip=this.tipElement.innerHTML)},getData:function(){var a,b,c,d,e={},f={};if(g.isArray(this.element))for(a=0,b=this.element.length;b>a;a++)c=this.element[a].name,d=this.element[a].value,e[c]=d,g.mix(f,e);else f[this.name]=this.value;return f},save:function(a){var b,c,d=[];if(a===!0)if(this.validate=!0,"INPUT"==this.type||"TEXTAREA"==this.type)if(g.isArray(this.element))for(b=0,c=this.element.length;c>b;b++)this.element[b].value=g.trim(this.element[b].ele.value);else this.value=this.element&&g.trim(this.element.value);else if("SELECT"==this.type)this.value=this.element&&this.element.options[this.element.selectedIndex].value;else if("RADIO"==this.type){for(b=0,c=this.element.length;c>b;b++)if(this.element[b].checked){this.value=this.element[b].value;break}}else if("CHECKBOX"==this.type){for(b=0,c=this.element.length;c>b;b++)this.element[b].checked&&d.push(this.element[b].value);this.value=d.join(",")}else try{this.value=this.element&&g.trim(this.element.value)}catch(e){throw new Error("formItem type is error!")}else this.validate=!1},bindDefaultEvent:function(){("INPUT"==this.type||"TEXTAREA"==this.type)&&(f(this.element).blur(this.blur),f(this.element).focus(this.focus))},setDefaultTip:function(){this.tipElement.innerHTML=this.tip,g.removeClass(this.tipElement.parentNode,this.errorClass)},isEmpty:function(a){return g.isEmpty(a)},rule:{},rollback:function(){var a=!0;return g.isObject(this.rule)&&g.each(this.rule,function(b){return g.isFunction(b)&&!b.call(this)?(a=!1,"break"):void 0},this,"break"),a},triggerValidate:function(){var a,b,c,d,e,f=!1;if(this.beforeValidate&&g.isFunction(this.beforeValidate)&&this.beforeValidate.apply(this,arguments),this.require){if("INPUT"==this.type||"TEXTAREA"==this.type||"SELECT"==this.type)if(c="SELECT"==this.type?"请选择":"请填写",g.isArray(this.element)){for(a=0,d=this.element.length;d>a;a++)if(this.isEmpty(this.element[a].ele.value))return this.save(!1),this.errorMessage=c+this.label,this.error(),!1}else if(c="FILE"==this.element.type.toUpperCase()?"请选择":c,e=this.element.value,this.isEmpty(e))return this.save(!1),this.errorMessage=c+this.label,this.error(),!1;if(("RADIO"==this.type||"CHECKBOX"==this.type)&&(g.each(this.element,function(a){return a.checked?(f=!0,"break"):void 0},this,"break"),!f))return this.save(!1),this.errorMessage="请选择"+this.label,this.error(),!1;if(b=this.rollback(),!b)return this.save(!1),this.error(),!1}else if("INPUT"==this.type||"TEXTAREA"==this.type)if(g.isArray(this.element)){for(a=0,d=this.element.length;d>a;a++)if(!this.isEmpty(this.element[a].ele.value)&&(b=this.rollback(),!b))return this.save(!1),this.error(),!1}else if(e=this.element.value,!this.isEmpty(e)&&(b=this.rollback(),!b))return this.save(!1),this.error(),!1;this.save(!0),this.setDefaultTip(),this.afterValidate&&g.isFunction(this.afterValidate)&&this.afterValidate.apply(this,arguments)},error:function(){this.tipElement&&!this.validate&&(this.tipElement.innerHTML=this.errorMessage||window.console&&console.log("errorMessage is null.")||"",g.addClass(this.tipElement.parentNode,this.errorClass))},focus:function(){this.setDefaultTip()},blur:function(a){this.triggerValidate(a)},receiver:function(a){if(a){var b=(a.target,a.name.split(":")[1]);switch(b){case"VALIDATE":this.revalidate(a)}}}}).inherits(i);c.exports=k});