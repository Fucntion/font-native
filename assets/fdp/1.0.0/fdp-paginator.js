define("fdp/1.0.0/fdp-paginator",["./fdp-namespace","cellula/0.4.2/cellula","cellula/0.4.2/cellula-namespace","cellula/0.4.2/cellula-class","cellula/0.4.2/cellula-util","cellula/0.4.2/cellula-events","cellula/0.4.2/cellula-cell","cellula/0.4.2/cellula-element","cellula/0.4.2/cellula-collection","$","select/1.0.0/select","select/1.0.0/selectSkin.css"],function(a,b,c){var d=a("./fdp-namespace"),e=a("cellula/0.4.2/cellula"),f=a("$"),g=a("select/1.0.0/select"),h=e._util,i=e.Class,j=e.Element,k=e.Cell,l=e.Collection,m=new i("SizeElement",{value:void 0,save:function(){return this.set(new Function("return {size : {sizeDefault:"+this.value+"}}").call(this))},init:function(a){this._super(a),this.set({size:{sizeDefault:20}})}}).inherits(j),n=new i("NumberElement",{value:void 0,save:function(){return this.set(new Function("return {number : {currentPage:"+this.value+"}}").call(this))},init:function(a){this._super(a),this.set({number:{currentPage:1}})}}).inherits(j),o=new i("PageElement",{save:function(){console.log("save page element data")},items:{},options:{},init:function(a){this._super(a),this.set({sizePerPage:20,totalItems:null,current:1})}}).inherits(j),p=d.Paginator=new i("Paginator",{hideClass:"fn-hide",sizeSelect:void 0,collection:void 0,pageDefault:{size:{sizeDefault:20},number:{currentPage:1},page:{first:1,last:null,prev:null,next:null,totalItems:null,totalPages:null,current:null,currentArray:null},sizeDefault:20,sizeOptions:[10,20,50]},pageTpl:'<span class="mi-paging-info fn-ml15">每页</span><select name="size" id="J_size">$-{#options}<option $-{#selected}selected $-{/selected} value="$-{num}">$-{num}</option>$-{/options}</select><span class="mi-paging-info mi-paging-which"><input type="text" id="J_number" name="number" value="$-{current}"></span><a href="javascript:;" class="mi-paging-item mi-paging-goto"><span class="paging-text">跳转</span></a><span class="mi-paging-info fn-ml15"><span class="paging-text mi-paging-bold">$-{current}/$-{totalPages}</span>页</span>$-{#pre}<a href="javascript:;" class="mi-paging-item mi-paging-prev fn-mr10"><span class="paging-text">上一页</span><span class="mi-paging-icon"></span></a>$-{/pre}$-{#preDis}<span class="mi-paging-item mi-paging-prev mi-paging-prev-disabled fn-mr10"><span class="paging-text">上一页</span><span class="mi-paging-icon"></span></span>$-{/preDis}$-{#next}<a href="javascript:;" class="mi-paging-item mi-paging-next"><span class="paging-text">下一页</span><span class="mi-paging-icon"></span></a>$-{/next}$-{#nextDis}<span class="mi-paging-item mi-paging-next mi-paging-next-disabled"><span class="paging-text">下一页</span><span class="mi-paging-icon"></span></span>$-{/nextDis}',typeEnum:{first:"\\bfirst\\b",last:"\\blast\\b",prev:"\\bprev\\b",next:"\\bnext\\b","goto":"\\bgoto\\b"},init:function(a){this._super(a),this._bindAll("changeSize","paginate"),this.collection=new l,this.collection.push(new m({key:"size"})),this.collection.push(new n({key:"number"})),this.collection.push(new o({key:"page"}))},receiver:function(a){if(a){var b=(a.target,a.name.split(":")[1]);switch(b){case"PAGINGRENDER":this.render(arguments[1]);break;case"GETDEFAULTPAGE":this.getDefault();break;case"GETCOLLECTION":this.getCollection();break;case"SYSTEMERROR":h.addClass(this.rootNode,this.hideClass);break;case"NORESULT":h.addClass(this.rootNode,this.hideClass)}}},getDefault:function(){this.emit("FORM:SETPAGEDEFAULT",this.pageDefault)},getCollection:function(){this.emit("FORM:SETPAGECOLLECTION",this.collection)},getOperationType:function(a){for(var b in this.typeEnum)if(new RegExp(this.typeEnum[b]).test(a))return b},calcNumber:function(a){var b=this.getOperationType(a.className),c=this.collection.get("page"),d=parseInt(c.get("current")),e=parseInt(c.get("totalPages"));return void 0===b?/(\D*)(\d+)(\D*)/.exec(a.innerHTML)?/(\D*)(\d+)(\D*)/.exec(a.innerHTML)[2]:void 0:"last"===b?e:"prev"===b?d-1>1?d-1:1:"next"===b?e>d+1?d+1:e:1},operate:function(a){var b=this.collection.get("number"),c=this.calcNumber(a);return b&&c?b.set(h.keys(b.get())[0],c):!1},paginate:function(a){a&&a.preventDefault&&a.preventDefault();var b=this.collection;if("goto"===this.getOperationType(a.currentTarget.className)){var c=this.pageDefault,d=f("input[name=number]",this.rootNode),e=b.get("size"),g=h.values(e.get())[0],i=b.get("number");isNaN(parseInt(d.val()))||parseInt(d.val())<1?(d.val(h.values(c.number)[0]),i.value=h.values(c.number)[0]):i.value=d.val(),i.save(),h.isEmpty(g)&&e.set({size:this.pageDefault.size}),this.emit("FORM:DOSEARCH",h.mix({},h.values(e.get())[0],h.values(i.get())[0]))}else if(this.operate(a.currentTarget)){var e=b.get("size"),g=h.values(e.get())[0],i=b.get("number");h.isEmpty(g)&&e.set(this.pageDefault.size),this.emit("FORM:DOSEARCH",h.mix({},h.values(e.get())[0],h.values(i.get())[0]))}},changeSize:function(){var a=this.collection.get("size");a.value=this.sizeSelect.getValue(),a.save(),this.emit("FORM:DOSEARCH",h.mix({},h.values(a.get())[0],this.pageDefault.number||{}))},prepareTplConfig:function(a){var b=this.collection.get("page");a&&b.set(a);var c,d=parseInt(b.get("current")),e=parseInt(b.get("totalItems")),f=this.pageDefault.size,g=h.values(this.collection.get("size").get())[0],i=parseInt(h.isEmpty(g)?h.values(f)[0]:h.values(g)[0]),j=e%i,k=(e-j)/i+(j>0?1:0),l=this.pageDefault.sizeDefault,m=(l-1)/2;1>d&&(d=1),d>k&&(d=k),b.set({totalPages:k}),c={size:i,pre:1!==d,preDis:!(1!==d),next:d!==k,nextDis:!(d!==k),options:[],totalItems:e,startItem:(d-1)*i+1,endItem:d*i>e?e:d*i,totalPages:k,totalShow:k>l&&k-m>d?!0:!1,ellipsis:k>l&&k-m-1>d?!0:!1,items:[],current:d};for(var n=1,o=k>l?l:k,p=m;o>=n;n++){var q=1;k>l?(d>m&&k-m>=d&&(q=d-p,p--),d>k-m&&(q=k-l+n),m>=d&&(q=n)):q=n,c.items.push({num:q,currentClass:d===q?!0:!1})}if(h.isArray(this.pageDefault.sizeOptions))for(var n=0,r=this.pageDefault.sizeOptions;n<r.length;n++)c.options.push({num:r[n],selected:i===r[n]});return c},error:function(){this.show(!1)},registerEvents:function(){this.sizeSelect&&(this.sizeSelect.onSelect=this.changeSize),f(".mi-paging-goto",this.rootNode).click(this.paginate),f(".mi-paging-item",this.rootNode).click(this.paginate)},render:function(a){if(!h.isEmpty(a)){var b,c=this.rootNode;c.innerHTML=h.parseTpl(this.pageTpl,this.prepareTplConfig(a)),b=f("select[name=size]",this.rootNode),b.length&&(this.sizeSelect=new g({width:58,size:3,zIndex:1}).apply(b[0])),h.removeClass(c,this.hideClass),this.registerEvents()}}}).inherits(k);c.exports=p});