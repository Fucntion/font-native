define("fdp/1.1.0/fdp-formItem",["./fdp-namespace","./async","cellula/0.4.2/cellula","cellula/0.4.2/cellula-namespace","cellula/0.4.2/cellula-class","cellula/0.4.2/cellula-util","cellula/0.4.2/cellula-events","cellula/0.4.2/cellula-cell","cellula/0.4.2/cellula-element","cellula/0.4.2/cellula-collection","$"],function(a,b,c){function d(a){return-1==i.inArray(a,m)}function e(a,b,c){if(this.name=a,b instanceof RegExp)this.operator=function(a,d){var e=b.test(i(a.element).val());d(e?null:a.rule,c.getMessage(a,e))};else{if(!i.isFunction(b))throw new Error("The second argument must be a function.");this.operator=function(a,d){var e=b.call(this,a,function(b,e){d(b?null:a.rule,e||c.getMessage(a,b))});void 0!==e&&d(e?null:a.rule,c.getMessage(a,e))}}}var f=a("./fdp-namespace"),g=a("./async"),h=a("cellula/0.4.2/cellula"),i=a("$"),j=h._util,k=h.Class,l=(h.Element,h.Cell),m=(h.Collection,["INPUT","SELECT","RADIO","CHECKBOX","TEXTAREA"]),n=f.FormItem=new k("FormItem",{type:"input",required:!0,skipNull:!1,validate:!1,hideClass:"fn-hide",errorClass:"mi-form-item-error",messages:{},tipClass:"mi-form-explain",label:void 0,tip:void 0,element:void 0,tipElement:void 0,value:void 0,beforeValidate:void 0,afterValidate:void 0,rules:{},init:function(a){this._super(a),this.key=this.key?this.key:this.__cid__,this.type=this.type.toUpperCase(),this.setElement(),this._bindAll("blur","focus","change"),this.bindDefaultEvent(),this.isRequired()},getOperator:function(a){return this.rules[a].operator},addRule:function(a,b,c){var d=this;return j.isObject(a)?(j.each(a,function(a,b){j.isArray(b)?d.addRule(a,b[0],b[1]):d.addRule(a,b)}),d):(d.rules[a]=b instanceof e?new e(a,b.operator,d):new e(a,b,d),d.setMessage(a,c),d)},getMessage:function(a,b){var c,d=a.rule;return a.message?i.isPlainObject(a.message)?(c=a.message[b?"success":"failure"],"undefined"==typeof c&&(c=messages[d][b?"success":"failure"])):c=b?"":a.message:c=this.messages[d][b?"success":"failure"],c?this.compileTpl(a,c):c},setMessage:function(a,b){var c=this;return i.isPlainObject(a)?(i.each(a,function(a,b){c.setMessage(a,b)}),c):(c.messages[a]=i.isPlainObject(b)?b:{failure:b},c)},compileTpl:function(a,b){var c=b,d=/\{\{[^\{\}]*\}\}/g,e=/\{\{(.*)\}\}/,f=b.match(d);return f&&i.each(f,function(b,d){var f=d.match(e)[1],g=a[i.trim(f)];c=c.replace(d,g)}),c},getRules:function(){var a=[];return j.each(this.rules,function(b,c){a.push(c)}),a},parseRule:function(a){var b=a.match(/([^{}:\s]*)(\{[^\{\}]*\})?/);return{name:b[1],param:i.parseJSON(b[2])}},getMsgOptions:function(a,b){var c=i.extend({},a,{element:this.element,display:this.label,rule:b}),d=void 0;return d&&!c.message&&(c.message={failure:d}),c},setElement:function(){var a,b=[],c=this.type,e=this.rootNode&&j.getElementsByClassName(this.tipClass,this.rootNode)[0];if(d(c))throw new Error("formItem type is error!");if("INPUT"==c||"TEXTAREA"==c||"SELECT"==c)if(this.element=this.rootNode&&this.rootNode.getElementsByTagName(c),1==this.element.length)this.element=this.element[0];else{for(a=0,len=this.element.length;a<len;a++)b.push(this.element[a]);this.element=b}("RADIO"==c||"CHECKBOX"==c)&&(this.element=i("[type="+c+"]",this.rootNode)),e&&(this.tipElement=e,this.tip=this.tipElement.innerHTML)},isEmpty:function(a){if(!j.isArray(a))return""==a.value;for(var b=0,c=a.length;c>b&&""!=a[b].value;b++);return!1},getData:function(){var a,b,c,d,e,f={},g={};if(j.isArray(this.element)&&j.isArray(this.value)){if(b=this.element.length,c=this.value.length,b!=c)return;for(a=0;b>a;a++)d=this.element[a].name,e=this.value[a],f[d]=e,j.mix(g,f)}else g[this.element.name]=this.value;return g},save:function(a){var b,c,d=[];if(a===!0){if("INPUT"==this.type||"TEXTAREA"==this.type)if(j.isArray(this.element))for(b=0,c=this.element.length;c>b;b++)d.push(j.trim(this.element[b].value));else d=j.trim(this.element.value);else if("SELECT"==this.type)d=this.element.options[this.element.selectedIndex].value;else if("RADIO"==this.type){for(b=0,c=this.element.length;c>b;b++)if(this.element[b].checked){d=this.element[b].value;break}}else if("CHECKBOX"==this.type){for(b=0,c=this.element.length;c>b;b++)this.element[b].checked&&d.push(this.element[b].value);d=d.join(",")}else try{d=j.trim(this.element.value)}catch(e){throw new Error("formItem type is error!")}this.value=d,this.validate=!0}else a===!1&&(this.validate=!1)},bindDefaultEvent:function(){var a=this.type,b=this.element;("INPUT"==a||"TEXTAREA"==a)&&(i(b).on("blur",this.blur),i(b).on("focus",this.focus)),("RADIO"==a||"CHECKBOX"==a||"SELECT"==a)&&i(b).on("change",this.change)},setDefaultTip:function(a){this.tipElement.innerHTML=a||this.tip,j.removeClass(this.tipElement.parentNode,this.errorClass)},isRequired:function(){var a=this,b=a.type,c=!1;a.required?a.skipNull||a.addRule("required",function(a){return("INPUT"!=b&&"TEXTAREA"!=b&&"SELECT"!=b||!this.isEmpty(a.element))&&("RADIO"!=b&&"CHECKBOX"!=b||(j.each(a.element,function(a){return a.checked?(c=!0,"break"):void 0},this,"break"),c))?!0:!1},"请输入"+a.label):this.isEmpty(this.element)&&(this.save(!0),this.emit("FORMITEM:TRIGGERFORM",{tg:void 0}))},triggerValidate:function(){var a=arguments[1]?arguments[1]:arguments[0];if(this.required)this.todo(a);else{if(this.isEmpty(this.element))return this.setDefaultTip(),this.save(!0),void this.emit("FORMITEM:TRIGGERFORM",{tg:a});if(j.isEmpty(this.rules))return this.setDefaultTip(),this.save(!0),void this.emit("FORMITEM:TRIGGERFORM",{tg:a});this.todo(a)}},todo:function(a){var b=this,c=this.getRules();if(!j.isArray(c))throw new Error("No validation rule specified or not specified as an array.");var d=[];i.each(c,function(a,c){var e=b.parseRule(c),f=e.name,g=e.param,h=b.getOperator(f);if(!h)throw new Error('Validation rule with name "'+f+'" cannot be found.');var i=b.getMsgOptions(g,f);d.push(function(a){h.call(b,i,a)})}),g.series(d,function(c,d){b.execute(c,d[d.length-1],a)})},execute:function(a,b,c){return"string"==typeof a?(this.save(!1),this.emit("FORMITEM:TRIGGERFORM",{tg:c}),void this.error(b)):void(null===a&&(this.save(!0),this.setDefaultTip(b),this.emit("FORMITEM:TRIGGERFORM",{tg:c})))},error:function(a){this.tipElement&&!this.validate&&(this.tipElement.innerHTML=a||window.console&&console.log("errorMessage is null.")||"",j.addClass(this.tipElement.parentNode,this.errorClass))},focus:function(){this.setDefaultTip()},blur:function(a){this.triggerValidate(a)},change:function(a){this.triggerValidate(a)},receiver:function(a){if(a){var b=(a.target,a.name.split(":")[1]);switch(b){case"VALIDATEING":this.triggerValidate(a,"FORM")}}}}).inherits(l);n.build=function(a,b){if("string"!=typeof a)throw new Error("`name` is expect a String type parameters.");return i.isPlainObject(b)?new k(a,b,"NEW").inherits(f.FormItem):null},c.exports=n});